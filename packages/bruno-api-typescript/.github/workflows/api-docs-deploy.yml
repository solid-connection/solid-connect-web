name: API Documentation ë°°í¬

on:
  push:
    branches:
      - main
    paths:
      - 'bruno/**'
      - 'openapi.json'

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3
        with:
          fetch-depth: 2  # ì´ì „ ì»¤ë°‹ê³¼ ë¹„êµìš©

      - name: Node ì„¤ì •
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm install

      - name: OpenAPI ìƒì„± ë° ë³€ê²½ì‚¬í•­ ê°ì§€
        run: |
          npm run build
          node dist/cli/index.js generate \
            -i ./bruno \
            -o ./docs/openapi.json \
            --title "ìš°ë¦¬íŒ€ API" \
            --version "1.0.0" \
            --diff \
            --changelog ./docs/changelog.html \
            --changelog-format html

      - name: ë°°í¬ í´ë” ì¤€ë¹„
        run: |
          # docs í´ë”ì— í•„ìš”í•œ íŒŒì¼ë“¤ì´ ì´ë¯¸ ìˆìŒ
          # api-viewer.html (Swagger UI)
          # changelog.html (ë³€ê²½ì‚¬í•­)
          # openapi.json (OpenAPI ìŠ¤í™)

          # index.html ìƒì„± (ë©”ì¸ í˜ì´ì§€)
          cat > docs/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="ko">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>API Documentation Hub</title>
            <style>
              * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
              }
              body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
              }
              .container {
                max-width: 800px;
                width: 100%;
              }
              h1 {
                color: white;
                text-align: center;
                margin-bottom: 40px;
                font-size: 2.5rem;
              }
              .cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
              }
              .card {
                background: white;
                border-radius: 12px;
                padding: 30px;
                text-decoration: none;
                color: inherit;
                transition: transform 0.3s, box-shadow 0.3s;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
              }
              .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 12px rgba(0,0,0,0.15);
              }
              .card-icon {
                font-size: 3rem;
                margin-bottom: 15px;
              }
              .card-title {
                font-size: 1.5rem;
                font-weight: bold;
                margin-bottom: 10px;
                color: #2c3e50;
              }
              .card-description {
                color: #7f8c8d;
                line-height: 1.6;
              }
              .footer {
                text-align: center;
                color: white;
                margin-top: 40px;
                opacity: 0.9;
              }
            </style>
          </head>
          <body>
            <div class="container">
              <h1>ğŸ“š API Documentation</h1>

              <div class="cards">
                <a href="./api-viewer.html" class="card">
                  <div class="card-icon">ğŸ“–</div>
                  <div class="card-title">API ëª…ì„¸ì„œ</div>
                  <div class="card-description">
                    Swagger UIë¡œ ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í™•ì¸í•˜ê³  í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.
                  </div>
                </a>

                <a href="./changelog.html" class="card">
                  <div class="card-icon">ğŸ”„</div>
                  <div class="card-title">ë³€ê²½ì‚¬í•­</div>
                  <div class="card-description">
                    ìµœì‹  API ë³€ê²½ì‚¬í•­ê³¼ Breaking Changesë¥¼ í™•ì¸í•˜ì„¸ìš”.
                  </div>
                </a>

                <a href="./openapi.json" class="card" download>
                  <div class="card-icon">â¬‡ï¸</div>
                  <div class="card-title">OpenAPI ë‹¤ìš´ë¡œë“œ</div>
                  <div class="card-description">
                    OpenAPI 3.0 ìŠ¤í™ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”.
                  </div>
                </a>
              </div>

              <div class="footer">
                <p>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="date"></span></p>
              </div>
            </div>

            <script>
              document.getElementById('date').textContent = new Date().toLocaleString('ko-KR');
            </script>
          </body>
          </html>
          EOF

      - name: GitHub Pages ë°°í¬
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          publish_branch: gh-pages

      - name: ë°°í¬ ì™„ë£Œ ì•Œë¦¼
        run: |
          echo "âœ… API ë¬¸ì„œê°€ GitHub Pagesì— ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤!"
          echo "ğŸ”— URL: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
